<%- include('../partials/header') %>
<h1>Login / Register</h1>
<div class="grid">
  <div class="card">
    <h3>Register</h3>
    <form id="regForm">
      <input name="name" placeholder="Name" required>
      <input name="email" placeholder="Email" required>
      <input name="password" type="password" placeholder="Password" required>
      <select name="role"><option value="poster">Job Poster</option><option value="tradie">Tradie</option></select>
      <button>Register</button>
    </form>
  </div>
  <div class="card">
    <h3>Login</h3>
    <form id="loginForm">
      <input name="email" placeholder="Email" required>
      <input name="password" type="password" placeholder="Password" required>
      <button>Login</button>
    </form>
  </div>
</div>
<script>
async function post(url, data){
  const r = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)});
  return r.json();
}
document.querySelector('#regForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  const json = await post('/api/auth/register', data);
  alert(json.ok ? 'Registered' : JSON.stringify(json));
});
document.querySelector('#loginForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());
  const json = await post('/api/auth/login', data);
  if(json.token){ localStorage.setItem('token', json.token); alert('Logged in'); location.href='/dashboard'; }
  else alert(JSON.stringify(json));
});
</script>
<%- include('../partials/footer') %>
